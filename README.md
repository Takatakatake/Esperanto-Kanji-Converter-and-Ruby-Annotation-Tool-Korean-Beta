# Esperanto-Kanji-Converter-and-Ruby-Annotation-Tool-Korean

---
아래 내용은 **에스페란토 문장을 (한자)로 치환**하고, 필요한 경우 **HTML 루비 형태로 변환**하는 Streamlit 앱(두 개의 주요 페이지 + 내부 모듈) 전체의 사용 방법과 흐름을 상세히 소개하는 설명서입니다.  
특히 **한국어 GUI 사용자**분들이 이 앱을 처음 접했을 때, 어떤 단계를 거쳐 어떻게 설정하고 결과물을 확인·다운로드할 수 있는지, **주요 기능과 버튼/위젯들이 어떤 역할을 하는지**를 중심으로 풀어서 적었습니다.  

---

## 개요: 앱의 전체 구성

1. **메인 페이지(`main.py`)**  
   - 실제로 에스페란토 문장을 입력(또는 파일로 업로드)하고,  
   - 미리 준비된(또는 업로드한) **치환용 JSON**을 활용하여 에스페란토 단어를 **한자(또는 한국어 번역 등)로 치환**한 뒤,  
   - 최종 결과를 다양한 형식(HTML 루비·괄호 표기·단순 치환 등)으로 확인하고 다운받을 수 있는 메인 기능 페이지입니다.

2. **JSON 생성 페이지(`에스페란토 문장의 (한자) 치환에 사용할 JSON 파일을 생성합니다.py`)**  
   - Streamlit에서 **pages** 폴더 안에 들어가 있는 보조 페이지입니다.  
   - 이 페이지는 사용자가 직접 CSV 파일(에스페란토 단어 목록과 대응 번역/한자 정보)이나 JSON 파일(단어 어근 분해 규칙, 커스텀 치환 후 문자열)을 업로드하여,  
   - **본격적인 치환용 JSON**(즉 `main.py`에서 “치환 규칙”으로 사용하는) 파일을 생성·다운로드할 수 있는 기능을 제공합니다.

3. **내부 모듈(`esp_text_replacement_module.py`, `esp_replacement_json_make_module.py`)**  
   - 앱 내부 로직, 에스페란토 문자의 변환(ĉ, ĝ 등), 치환 처리(safe_replace) 및 병렬 처리 함수를 묶어 둔 Python 모듈들입니다.  
   - 사용자 입장에서 직접 설정해야 하는 부분은 아니며, **“어떻게 문장을 치환하는지(세부 로직)”**가 궁금할 때 내부를 살펴보면 도움이 됩니다.

---

## 1. 메인 페이지(`main.py`) 사용법

### (1) 페이지 실행·접속
- Streamlit Cloud(또는 로컬에서 `streamlit run main.py`)를 통해 앱에 접속하면,  
- **브라우저** 화면에 `main.py`의 GUI가 표시됩니다.  
- 페이지 상단에는 “에스페란토 문장을 한자로 치환하거나, HTML 형식의 번역 루비를 적용하기 (확장판)”와 같은 **제목**이 보일 것입니다.

### (2) JSON 파일(치환 규칙) 선택  
1. **치환용 JSON 파일을 어떻게 불러올지** 라디오버튼에서 “기본값 사용” 혹은 “업로드하기”를 선택합니다.  

   - **기본값 사용**:
     - `./Appの运行に使用する各类文件/最终的な替换用リスト(列表)(合并3个JSON文件).json` 라는 이미 준비된 JSON 파일을 사용합니다.  
     - 이 JSON 파일은 “전역 치환용, 2글자 치환용, 국소 치환용” 총 3개 리스트가 모두 합쳐져 있는 통합 파일입니다.  
     - 기본값 사용을 선택하면, 자동으로 이 JSON을 로드합니다.

   - **업로드하기**:
     - 사용자가 **직접 JSON 파일**을 업로드합니다.  
     - “Choose a file” 같은 파일 선택 위젯이 뜨면,  
       - 미리 만들어둔(또는 JSON 생성 페이지에서 다운로드한) **치환용 JSON**을 업로드하면 됩니다.  
     - 제대로 불러오면 “업로드한 JSON을 성공적으로 불러왔습니다.” 라는 메시지가 표시됩니다.

2. (옵션) **샘플 JSON** 다운로드  
   - 화면에서 “샘플 JSON(치환용 JSON 파일) 다운로드” 버튼이 보이는데,  
   - 이를 통해 **기본 JSON**을 미리 다운로드받아 내부 구조를 살펴볼 수 있습니다.  
   - JSON 내부에는 “전역 치환용의 (old, new, placeholder) 목록”, “국소 치환용”, “2글자 치환용” 목록이 들어 있습니다.

### (3) 占位符(placeholder) 로드  
- 내부적으로 `./Appの运行に使用する各类文件/占位符(...)` 등에 정의된 **플레이스홀더**(치환 충돌 방지용 특수 문자들)를 불러옵니다.  
- 사용자 쪽에서 직접 무언가 할 필요는 없지만, **“% 로 감싼 부분은 치환 대상에서 제외”** 같은 기능이 이 플레이스홀더 매커니즘에 의해 작동한다는 점 정도만 알아두면 됩니다.

### (4) 고급 설정(병렬 처리)  
- **“병렬 처리를 사용하기”** 체크박스를 통해, 에스페란토 문자열 치환 작업을 여러 프로세스로 병렬화할 수 있습니다.  
- **“동시 프로세스 수”**를 2~4개 정도 설정해둘 수 있는데, 대용량 텍스트를 치환할 때 속도를 높이는 데 도움이 됩니다.  
- 병렬 처리를 활성화하지 않으면, 단일 프로세스로 천천히 진행합니다.

### (5) 출력 형식(HTML/괄호/단순치환 등) 선택  
- 드롭다운(셀렉트박스)에서 **“HTML형식 루비 문자 크기조정”, “괄호 형식”, “단순 치환”** 등 다양한 **출력 방식**을 고를 수 있습니다.
  - **HTML형식_Ruby문자_크기조정**:  
    - 에스페란토 원문을 본문으로, 루비에 한자(혹은 번역)를 표시합니다.  
    - 루비 글자폭이 본문보다 지나치게 길면 여러 줄로 나누는 등, **가독성을 높이기 위해 루비 폰트 크기를 상황에 맞춰 조정**해 줍니다.
  - **HTML형식_Ruby문자_크기조정(한자 치환)**:  
    - 에스페란토 원문과 한자의 **역할을 뒤집어** 표시합니다. (한자를 본문, 에스페란토를 루비)  
    - 나머지 규칙은 거의 동일하며, 마찬가지로 길이에 따라 글자 크기를 다르게 적용합니다.
  - **HTML형식** / **HTML형식(한자 치환)**:  
    - 글자폭 조정 없이 `<ruby>원문<rt>번역</rt></ruby>` 구조로만 간단히 붙입니다.  
    - (한자 치환) 옵션은 본문이 한자, 루비가 에스페란토가 됩니다.
  - **괄호 형식** / **괄호 형식(한자 치환)**:  
    - `원문(번역)` 혹은 `한자(원문)` 형태로 간단히 치환 결과를 괄호에 넣어 표시합니다.  
    - HTML을 지원하지 않는 환경(예: 단순 텍스트)에서도 편하게 볼 수 있습니다.
  - **치환 후 문자열만(간단 치환)**:  
    - 그냥 “번역(혹은 한자) 텍스트”만 남기는 방법입니다(원문 제거).  
    - 예: `Esperanto` → `세계어` 로 치환하면 최종 텍스트가 `세계어`만 남습니다.

### (6) 에스페란토 문장 입력 방식
- 화면에서 **“입력 텍스트의 소스”**를 **직접 입력** 혹은 **파일 업로드** 중 고를 수 있습니다.

1. **직접 입력**  
   - 텍스트 박스에 여러 줄로 직접 에스페란토 문장을 붙여 넣습니다.  
   - 뒤에서 “전송” 버튼을 누르면 치환이 수행됩니다.

2. **파일 업로드**  
   - `.txt`, `.csv`, `.md` 형식의 텍스트 파일을 업로드할 수 있습니다.  
   - 업로드 성공 시 “파일을 불러왔습니다.” 메시지가 뜨고, 이후 입력 텍스트로 사용됩니다.

- 참고:  
  - `@문자@` 형태로 감싸면 **국소 치환** 대상이 되고,  
  - `%문자%` 형태로 감싸면 **치환에서 제외**되어 그대로 남기는 기능을 제공합니다.  
  - 예: `%Tio chi estas skip%` → `% ... %` 사이 문자열은 전혀 치환되지 않습니다.

### (7) 전송/취소 버튼
- 모든 설정을 마친 뒤 **“전송”** 버튼을 클릭합니다. (취소 시 아무 작업 없이 중단)  
- 전송 시, 선택한 병렬 처리 옵션과 출력 형식, JSON을 바탕으로 **한자(또는 번역)이 적용된 최종 텍스트**가 생성됩니다.

### (8) 치환 결과 미리보기 및 다운로드
- 결과가 길면 250줄까지만 미리 표시하고, 나머지는 “... 생략 ...” 형태로 축약합니다.  
- **HTML 형식**으로 치환했다면,  
  - 탭(Tab) 형태로 **“HTML 미리보기”**와 **“치환 결과(HTML 소스 코드)”** 두 가지를 볼 수 있습니다.  
  - “HTML 미리보기” 탭에서는 실제 브라우저에서 `<ruby>...</ruby>`를 **렌더링한 모습**을,  
  - “치환 결과(HTML 소스 코드)” 탭에서는 태그가 들어간 **소스 형태**를 확인하게 됩니다.
- **괄호 형식** 또는 **단순 치환** 등 HTML이 아닌 경우에는 그냥 텍스트 영역에 최종 결과가 표시됩니다.
- 마지막으로, **“치환 결과 다운로드”** 버튼을 클릭하여 `.html` 파일 형태로 내려받을 수 있습니다.

### (9) GitHub 리포지토리 링크
- 페이지 하단에 이 앱의 GitHub 리포지토리 링크(`https://github.com/...`)가 표시됩니다.  
- 소스 코드를 살펴보거나, 이 프로젝트를 직접 포크해보고 싶다면 참고하시면 됩니다.

---

## 2. “에스페란토 문장의 (한자) 치환에 사용할 JSON 파일을 생성합니다.py” 사용법

### (1) 페이지 접근  
- Streamlit 특성상, **앱 상단(또는 측면) 메뉴**에서 **“Pages”** 항목을 펼치면,  
  - “에스페란토 문장의 (한자) 치환에 사용할 JSON 파일을 생성합니다” 라는 페이지가 보일 겁니다.  
- 해당 항목을 클릭하면 이 페이지로 이동됩니다.  
  - 또는 URL에 `/?page=에스페란토 문장의 (한자) 치환에 사용할 JSON 파일을 생성합니다` 식으로 들어갈 수도 있습니다.

### (2) 페이지 목적  
- `main.py`에서 활용할 **치환용 JSON**(3개 리스트가 합쳐진 최종 파일)을 여기서 생성할 수 있습니다.  
  - 예:
    - CSV로 관리하고 있는 어근-한자(혹은 한국어 번역) 대응 목록을 한번에 읽어와서,  
    - 여기에 **사용자 정의 JSON**(어근 분해 규칙, 특정 단어의 별도 치환) 등을 반영한 뒤,  
    - 최종적으로 “전역 치환용 / 국소 치환용 / 2글자치환용”이 모두 합쳐진 JSON으로 만들어줍니다.

### (3) 주요 단계별 설명

1. **샘플 파일 다운로드(Expander)**  
   - 이 페이지 상단에 **샘플 CSV/JSON/Excel 파일**을 다운받을 수 있는 버튼들이 있습니다.  
   - 예시:  
     - “에스페란토 어근-한국어 번역 루비 대응 목록.csv”  
     - “Mingeo판 에스페란토어근-한자대응 목록.csv”  
     - “(사용자 정의) 세계어 단어 어근분해법.json”  
     - …  
   - 원하는 형식을 참고·수정하여 **자신만의 CSV나 JSON**을 만든 뒤 업로드할 수 있습니다.

2. **출력 형식 선택**  
   - `main.py`의 경우와 마찬가지로, **HTML 루비, 괄호 형식, 단순 치환** 등 **출력 형식**을 이 페이지에서도 지정할 수 있습니다.  
   - 실제로 JSON 생성 시, CSV에 적힌 “에스페란토 단어”와 “대응 한자/번역”을 `<ruby>...</ruby>` 형태로 묶는지, 혹은 단순히 괄호로 묶는지 등, **최종 치환 구조**가 이 옵션에 따라 달라집니다.

3. **단계 1: CSV 파일 준비**  
   - **“업로드하기”** 또는 **“기본값 사용”**을 선택.  
   - 업로드하기를 고르면 CSV를 드래그 앤 드롭(또는 탐색 후 열기)하면 됩니다.  
   - “기본값 사용”이면, 예제 경로(`./Appの运行に使用する各类文件/에스페란토 어근-한국어 번역 루비 대응 목록.csv`)를 자동으로 불러옵니다.  
   - 문제없이 불러오면 “CSV 파일이 업로드되었습니다” 또는 “기본 CSV를 사용합니다” 메시지가 나옵니다.

4. **단계 2: JSON 파일(어근 분해법 등) 준비**  
   - **두 가지 JSON**을 각각 업로드하거나 기본값 사용을 선택할 수 있습니다.  
     1) **어근 분해법 사용자 정의** JSON  
        - 예: `["am", "dflt", ["verbo_s1"]]` 형식처럼, “`am`라는 단어는 기본(dflt) 우선순위로 취급하되, 동사접미어(as, is, os...) 등을 붙인 변형도 한꺼번에 만든다” 등의 규칙을 추가 가능.  
     2) **치환 후 문자열 사용자 정의** JSON  
        - 특정 단어나 구문을 별도 치환하거나, 우선순위를 강제 지정(-1이면 아예 치환 대상에서 제외 등)하는 설정.  
   - “기본값 사용” 옵션으로 진행하면, `./Appの运行に使用する各类文件/세계어단어_사용자커스텀.json` 등을 바로 사용합니다.

5. **단계 3: 고급 설정(병렬 처리)**  
   - CSV → JSON 치환 규칙 생성 과정에서도 **병렬 처리**를 적용할 수 있습니다.  
   - 대규모 CSV(수만~수십만 개 어근?)를 처리할 때 유용합니다.

6. **마지막: “치환용 JSON 파일 생성하기” 버튼**  
   - 이 버튼을 클릭하면, “JSON 생성 중... 잠시만 기다려 주십시오.”라는 메시지와 함께  
   - 업로드한 CSV·JSON 정보가 합쳐져서 **최종 치환용 JSON**을 만듭니다.  
   - 완료 시,  
     - “Download 최종 치환용 리스트(합병 3개 JSON)” 라는 다운로드 버튼이 표시됩니다.  
     - 이걸 누르면 `最终的な替换用リスト(列表)(合并3个JSON文件).json` 파일을 받을 수 있습니다.  
   - 받은 JSON은 **`main.py`에서 “업로드하기”**를 통해 사용 가능하며, 이때 “기본값 사용” 대신 **“내가 직접 만든 JSON 업로드”**를 선택하여 불러오면 됩니다.

---

## 3. 내부 모듈(`esp_text_replacement_module.py`, `esp_replacement_json_make_module.py`)

이 두 파일은 **치환 로직**(safe_replace), **에스페란토 문자열 정규화**(cx→ĉ 등), **HTML 루비 폰트 사이즈 조절** 등 세부 함수들을 모은 Python 모듈입니다.

- `esp_text_replacement_module.py`:
  - Streamlit용 멀티프로세싱(pool) 처리,  
  - `%문자%` 스킵 처리, `@문자@` 국소 치환,  
  - “전역 치환 리스트” 적용 등 **실제 치환 과정** 전반을 담당합니다.

- `esp_replacement_json_make_module.py`:
  - CSV 내 에스페란토 단어를 안전하게 치환(safe_replace)하고,  
  - 2글자 접두·접미 처리, 동사활용(as, is, os...) 우선순위 부여,  
  - 특정 JSON 설정(“어근 분해법”/“치환 후 문자열”) 병합 등을 수행하는,  
  - **치환용 JSON 파일 생성**에 특화된 로직을 담고 있습니다.

일반 사용자는 직접 이 모듈을 수정할 일은 많지 않으나,  
**“어떻게 에스페란토 문장을 한자로 바꾸는지 구체적인 알고리즘이 궁금하다”**면 이 내부 함수를 참고하시면 됩니다.

---

## 4. 자주 묻는 질문(FAQ)

1. **Q. CSV에 에스페란토 단어를 많~이 넣었는데, 치환 속도가 느린 것 같습니다.**  
   **A.**  
   - “병렬 처리” 옵션을 켜고 프로세스 수를 4 정도로 늘려 보세요.  
   - 텍스트가 매우 길거나, CSV가 방대할 경우 병렬화로 속도를 개선할 수 있습니다.

2. **Q. HTML 루비가 깨져 보여요.**  
   **A.**  
   - 일부 오래된 브라우저나 특정 환경에서는 `<ruby>...</ruby>` 표준을 완벽 지원하지 않을 수 있습니다.  
   - 이럴 때는 “괄호 형식”을 고려하시거나, CSS를 바꾸거나, 다른 뷰어에서 열어보길 권장합니다.

3. **Q. `@부분@` 으로 한정해서만 치환하고 싶어요.**  
   **A.**  
   - `@ ~ @`로 감싸면, “국소 치환 전용” 리스트에만 매칭을 시도합니다.  
   - `% ~ %`로 감싸면 전혀 치환이 일어나지 않고 **원문 보존**됩니다.

4. **Q. 치환 결과를 보고 싶지 않은(또는 제외하고 싶은) 에스페란토 단어가 있습니다.**  
   **A.**  
   - JSON 생성 페이지에서 “-1” 우선순위로 설정하거나, 특정 키를 pop 처리하도록 커스텀 JSON을 작성하면 해당 단어를 치환 제외로 만들 수 있습니다.

5. **Q. 치환 결과가 너무 깁니다. 미리보기에서 줄이 잘리는데 전부 보려면 어떻게 하나요?**  
   **A.**  
   - 현재 `main.py`에는 250줄까지만 미리보기로 표시하는 로직이 있습니다.  
   - 전체 내용이 궁금하면 **“치환 결과 다운로드(.html)”** 버튼으로 파일을 받아보세요.

---

## 5. 요약 및 마무리

- **메인 페이지(`main.py`)**:  
  에스페란토 문장을 직접 치환해 결과를 확인·다운받는 페이지입니다.  
  - JSON(치환 규칙) 불러오기  
  - 텍스트 입력(또는 파일)  
  - 출력 형식 선택  
  - 결과 미리보기 & 다운로드  

- **JSON 생성 페이지**:  
  **CSV + 사용자 정의 JSON** → 최종 치환용 JSON(3개 리스트 합본)을 만들어서,  
  **`main.py`에서 사용**할 수 있는 파일을 다운로드해주는 페이지입니다.

- **내부 모듈** 두 개(`esp_text_replacement_module.py`, `esp_replacement_json_make_module.py`)는  
  치환, 병렬 처리, 어근 분해 규칙 등을 실제로 구현하는 핵심 로직을 담은 파일이며,  
  사용자가 **에스페란토 → 한자/번역** 매핑을 세밀하게 관리하고 싶다면 소스 내용을 참고하면 좋습니다.

이상으로, 이 앱을 처음 사용하시는 **한국어 GUI 사용자**분들을 위한 **에스페란토-한자 치환 도구**의 자세한 매뉴얼을 안내해드렸습니다.  

- 실제로는 “JSON 생성 페이지”에서 사용자 맞춤형 CSV, JSON을 합쳐 한꺼번에 치환 규칙을 만들어 쓰고,  
- “메인 페이지”에서 원하는 텍스트(에스페란토 원문)를 가져다가 다양한 방식으로 한자(또는 한국어 번역어)로 변환해볼 수 있습니다.  

앱을 활용하시면서 **어떤 식으로 단어가 변환되는지, 루비 표시가 잘 보이는지**를 실습해보시고, 필요 시 GitHub 리포지토리나 추가 문서를 참고해주세요.  

감사합니다!
