# Esperanto-Kanji-Converter-and-Ruby-Annotation-Tool-Korean

---
아래는 **에스페란토 문장을 (한자)로 치환**할 수 있는 Streamlit 애플리케이션(한국어 버전)의 **상세 사용 설명서**입니다.  
이 문서는 **앱을 직접 GUI로 사용**하는 한국 사용자분들을 위해 작성되었습니다.  
(코드 레벨의 세부 구현보다는, **어떻게 설정/조작하여 원하는 결과**를 얻을 수 있는지가 초점입니다.)

---

# 목차

1. **애플리케이션 개요**  
2. **메인 페이지: `main.py`**  
   - 2.1. 치환 규칙 JSON 설정하기  
   - 2.2. 플레이스홀더(占位符) 읽기  
   - 2.3. 병렬 처리 설정  
   - 2.4. 입력 텍스트(직접 입력/파일 업로드)  
   - 2.5. 출력 형식(HTML 루비/괄호/간단 치환 등) 선택  
   - 2.6. 에스페란토 특유 문자 표기 방법(상단 첨자/x 형식/^ 형식)  
   - 2.7. 결과 확인 및 다운로드  
3. **서브 페이지: `에스페란토 문장의 (한자) 치환에 사용할 JSON 파일을 생성합니다.py`**  
   - 3.1. CSV 파일 준비하기  
   - 3.2. (선택) 어근 분해법 JSON, 치환 후 문자열 JSON 업로드  
   - 3.3. 병렬 처리 설정  
   - 3.4. “치환용 JSON 생성” 버튼으로 대규모 JSON 만들기 및 다운로드  
4. **핵심 개념**: `%...%`로 감싼 부분(치환 제외), `@...@`로 감싼 부분(국소 치환), placeholder로 안전 교체  
5. **자주 묻는 질문 / 팁**

---

## 1. 애플리케이션 개요

이 애플리케이션은 **에스페란토 문장을 한자로 치환**하고, 필요하다면 `<ruby>` 태그를 이용해 **루비(보조 글자)**를 표시하거나, 괄호 형식 등으로 번역/한자를 병기할 수 있도록 도와줍니다.

- **`main.py`**:  
  - 앱을 실행했을 때 기본으로 열리는 메인 페이지입니다.  
  - 여기서 *치환 규칙 JSON* 파일(혹은 기본 JSON)을 불러와서,  
  - 사용자가 에스페란토 텍스트를 입력(직접/파일 업로드) → 치환 결과를 즉시 확인 & 다운로드.  

- **`에스페란토 문장의 (한자) 치환에 사용할 JSON 파일을 생성합니다.py`**:  
  - `pages` 폴더 안에 존재하며, *“서브 페이지”* 로서,  
  - CSV 파일(“에스페란토 단어 어근→번역/한자” 정보가 들어 있음)과 여러 설정(JSON)을 합쳐,  
  - **메인 페이지에서 쓸 수 있는 커스텀 치환용 JSON**을 대규모로 생성하고 다운로드하게 해줍니다.  
  - 사용자가 직접 CSV/JSON 파일을 편집해 “내가 원하는 형태”로 치환 규칙을 강화하고자 할 때 유용합니다.

정리하면,
- **간단히**: “이미 만들어진 JSON” 사용 → `main.py`에서 바로 문장을 치환,  
- **고급**: “내가 직접 CSV와 JSON을 업로드해 방대한 치환 규칙 생성” → `에스페란토 문장의 (한자) 치환에 사용할 JSON 파일을 생성합니다.py` 페이지에서 대규모 JSON 만든 뒤, 그걸 `main.py`에 업로드해서 활용.

---

## 2. 메인 페이지: `main.py`

### 2.1. 치환 규칙 JSON 설정하기

앱 시작 후, 화면 상단에서 **JSON(치환 규칙) 파일**을 읽어오는 방식을 선택할 수 있습니다:

- “기본값 사용”  
  - 미리 준비된 디폴트 JSON(`./Appの运行に使用する各类文件/최종의 치환 리스트.json` 등)을 불러옴.  
- “업로드하기”  
  - 사용자가 생성한 JSON 파일(예: 서브 페이지에서 만든 것)을 업로드.

JSON에는 크게 **3가지** 치환 리스트가 들어 있습니다:

1. **전역 치환 리스트**(`replacements_final_list`)  
   문서 전역에 걸쳐(특정 예외를 제외하고) 에스페란토 단어를 한자로 치환하기 위한 규칙들.  
2. **국소 치환 리스트**(`replacements_list_for_localized_string`)  
   `@...@`로 감싼 부분에만 적용할 치환 규칙.  
3. **2글자 어근 치환 리스트**(`replacements_list_for_2char`)  
   예: `$ar`, `$am`처럼 2글자로 된 접두·접미 등을 중점적으로 2회 스캔할 치환 규칙.

JSON 파일을 불러오면, 이후 단계에서 한자 치환이나 루비 적용을 할 수 있게 됩니다.

### 2.2. 플레이스홀더(占位符) 읽기

내부적으로 `%1854%-%4934%_문자열치환 skip용.txt` 등 다양한 파일에서 placeholder를 읽습니다.  
이는 뒤에 설명할 `%...%`, `@...@` 등의 구간을 “치환 제외/국소 치환” 하기 위해 임시로 치환하는 문자들입니다.  
사용자는 별도의 조작 필요 없습니다.  
(*이 로직은 코드를 실행하면 자동으로 처리되어, 성능이나 충돌 방지에 도움을 줍니다.*)

### 2.3. 병렬 처리 설정

주 화면에서 “고급 설정(병렬 처리)” 영역을 펼치면,  
- **병렬 처리를 사용할 것인지**와  
- **동시에 몇 개의 프로세스를 사용할 것인지**  
설정할 수 있습니다.

문서가 매우 길면(수만 줄), 병렬 처리로 속도를 개선할 수 있지만,  
Streamlit Cloud 환경에서는 CPU 코어 제한으로 큰 차이가 없을 수도 있습니다.  
일반 PC에서 Python 실행 시 유리할 수 있습니다.

### 2.4. 입력 텍스트(직접 입력/파일 업로드)

다음으로, **에스페란토 문장을 어디서 가져오는지**를 묻습니다:

- “직접 입력”  
  - 큰 텍스트 상자에 에스페란토 문장을 붙여넣거나 타이핑.  
- “파일 업로드”  
  - `.txt`/`.md` 등 UTF-8 텍스트 파일을 업로드 → 그 내용을 불러옵니다.

### 2.5. 출력 형식 선택

“출력 형식을 선택하십시오”라는 **Selectbox**에서,  
- HTML 루비(크기 조정)  
- 괄호 형식  
- 간단 치환(치환 후의 텍스트만 남김)  
등을 고를 수 있습니다.  
**JSON 파일 생성할 때도 같은 형식을 쓴다면** 치환 결과가 일관되게 나옵니다.

**각 형식 예시**:
- **HTML형식_Ruby문자_크기조정**: `<ruby>에스페란토<rt class="M_M">[한자]</rt></ruby>` 형태 + 루비 글꼴 크기 자동 조정  
- **괄호 형식**: `에스페란토(한자)`  
- **단순 치환**: 원래 에스페란토 단어를 지우고 한자만 남김

### 2.6. 에스페란토 특유 문자 표기 방법(상단 첨자/x 형식/^ 형식)

입력한 에스페란토 문장에 `cx`, `c^` 등 혼용될 수 있는데, 최종 치환 결과에는  
- **상단 첨자**: 예) `ĉ → c + ˆ(상단첨자처럼 보이게)`  
- **x 형식**: `ĉ → cx`  
- **^ 형식**: `ĉ → c^`  
중 하나를 선택.  
에스페란토 문자를 어떤 형식으로 보여줄지를 결정합니다.

### 2.7. 결과 확인 및 다운로드

- **결과 미리보기**  
  - 만약 결과가 매우 길면, 앞 247줄 + 뒤 3줄만 표시하고 중간은 “...”로 생략.  
  - **HTML** 형식일 경우, 실제 `<ruby>`가 렌더링된 모습(“HTML 미리보기”)과 소스 코드(“HTML 소스 코드”)를 탭으로 나눠 확인.  

- **결과 다운로드**  
  - “치환 결과 다운로드” 버튼을 통해 `.html` 파일 형태로 내려받습니다.  
  - 필요하다면 이 `.html` 파일을 로컬 브라우저에서 열어 `<ruby>`가 잘 보이는지 체크할 수 있습니다.

---

## 3. 서브 페이지: `에스페란토 문장의 (한자) 치환에 사용할 JSON 파일을 생성합니다.py`

만약 “CSV에 에스페란토-한국어(또는 한자) 대응표를 내가 모아서 등록해놓고, 거기에 특정 단어별 특수 분해·커스터마이징을 하고 싶다.”면 이 서브 페이지에서 JSON을 *직접 생성*할 수 있습니다.

### 3.1. CSV 파일 준비하기

- “CSV 파일을 업로드” vs “기본 CSV 사용” 라디오 버튼이 있음.  
- CSV는 최소 2열: **(에스페란토 어근, 한자/한국어 번역)**  
- 업로드된 CSV가 저장되면, 이후 “한자 치환 규칙”을 만들 때 사용됨.

### 3.2. (선택) 어근 분해법 JSON, 치환 후 문자열 JSON 업로드

- **어근 분해법 JSON**(예: “단어 ~는 동사 어근이므로 as/is/os/us 파생형도 높은 우선순위로 등록” 등)을 설정.  
- **치환 후 문자열 JSON**(“이 단어는 표준 CSV 내용과 달리, 특정 한자를 쓰겠다”처럼 소수 단어에만 특별 치환).  

없어도 기본값을 사용할 수 있지만, 에스페란토를 광범위하게 커스텀하고 싶으면 편집해서 업로드합니다.

### 3.3. 병렬 처리 설정

- 메인 페이지와 유사하게, CSV와 JSON을 합치는 과정에서 큰 데이터를 병렬로 처리하여 속도를 높일 수 있음.  

### 3.4. “치환용 JSON 생성” 버튼으로 대규모 JSON 만들기 및 다운로드

버튼을 누르면 내부적으로:

1. 에스페란토 전체 단어 리스트(PEJVO 등에서 뽑은 ~4만 단어) + 사용자가 등록한 CSV(어근→번역) 정보  
2. 사용자가 지정한 “동사 접미사(as/is/os/us)”나 “an/on” 등 접두·접미 구별 로직  
3. (필요 시) 어근 분해법 JSON, 치환 후 문자열 JSON

…을 모두 합쳐서  
**세 가지** 리스트를 생성합니다.

- **`replacements_final_list`**: 전역 치환용  
- **`replacements_list_for_2char`**: 2글자 어근이나 접두·접미 처리  
- **`replacements_list_for_localized_string`**: 국소 치환(@...@)용  

이후 이 세 리스트를 하나의 JSON으로 만들어, **“합병 3개 JSON 파일”**처럼 결과물을 다운로드합니다.  
이 다운로드 받은 JSON을 곧바로 메인 페이지(`main.py`)에서 “업로드하기”로 불러오면,  
**작성한 규칙**대로 에스페란토→한자 치환이 진행됩니다.

---

## 4. 핵심 개념: `%...%` 치환 제외, `@...@` 국소 치환, placeholder 이용

- **`%...%`**:  
  - 이 앱은 “이 부분만은 치환하지 말고 원문 그대로 남겨둬라” 하는 구간을 `%`로 감쌉니다.  
  - ex) `%Korea%` → 치환 과정에서 placeholder로 변환되었다가, 나중에 원문 그대로 복원.  

- **`@...@`**:  
  - 이 앱은 “이 부분만은 **일반 치환 대신** 국소 치환 리스트(`replacements_list_for_localized_string`)를 사용”하도록 만듭니다.  
  - ex) `@danke@` 안의 단어만 국소 변환(특수 규칙) 사용.

- **placeholder를 통한 안전 교체**  
  - 텍스트 전체 치환 과정에서, “한 번 치환된 결과가 다시 다른 규칙에 걸려 중복 적용되는 실수”를 막기 위해,  
  - 모든 치환은 “old 단어 → placeholder → new 단어” 단계를 거쳐 적용합니다.  
  - 한 어근이 치환된 부분은 임시 식별 문자열(placeholder)로 바뀌어 더 이상 다른 치환 규칙에 걸리지 않도록 하는 방식입니다.

---

## 5. 자주 묻는 질문 / 팁

1. **“기본 JSON을 쓰면 용량이 커서 로드가 느립니다.”**  
   - 내부적으로 `@st.cache_data`로 **JSON 로드 결과**를 캐시하여, 두 번째부터는 훨씬 빨리 불러옵니다.  
   - 그래도 처리 시간이 길 경우 “병렬 처리”를 사용하거나, CSV나 JSON을 더욱 분할해볼 수도 있습니다.

2. **2글자 어근 치환(2회 스캔)은 무슨 의미인가요?**  
   - 에스페란토에는 “al, am, av…” 등 2자 접두/접미가 많아, 한 번의 치환으로 놓칠 수 있는 부분을 두 번 확인하기 위함입니다.

3. **HTML 형태로 치환했는데, `<ruby>`가 잘 표시되지 않아요.**  
   - 일부 브라우저/뷰어는 `<ruby>` 태그 지원이 부족합니다.  
   - 그런 경우 “괄호 형식”이나 “단순 치환”을 쓰거나, 별도의 CSS/JS(루비 폴리필)를 적용해야 합니다.

4. **병렬 처리를 해도 오류가 나요.**  
   - Windows나 일부 환경에서는 `multiprocessing.set_start_method('spawn')`을 미리 해두어야 합니다.  
   - 본 코드는 이미 try-except로 처리를 시도하지만, 호환성 문제가 생길 수도 있습니다.

5. **너무 긴 치환 결과를 전부 보고 싶어요.**  
   - 메인 페이지는 미리보기 제한이 있으니, “치환 결과 다운로드(.html)” 받고 나서 로컬 에디터나 브라우저에서 전체 확인 가능합니다.

---

# 결론

- **간단 이용**:  
  1) `main.py` 페이지에서 “기본 JSON” 또는 “내가 업로드한 JSON” 선택  
  2) 에스페란토 텍스트 입력 또는 업로드  
  3) 치환/결과 다운로드  

- **고급 커스터마이징**:  
  1) “서브 페이지”에서 CSV + (선택) 어근 분해법 JSON/치환후문자열 JSON을 합쳐 대규모 치환 규칙(JSON) 생성  
  2) 생성된 JSON을 `main.py`에 업로드  
  3) 에스페란토 텍스트 치환  

여러 편리한 형식(HTML 루비, 괄호, 한자만 등)을 지원하고, 또한 **`%...%`, `@...@`** 표기를 통해  
부분 치환 제외나 국소 치환을 섬세히 제어할 수 있다는 점이 특징입니다.  
원하시는 대로 앱 설정을 바꿔, **에스페란토 문서를 한자화** 하거나 **루비**를 달아보시길 바랍니다.  
궁금한 점이 있다면 코드 내부 주석이나 GitHub 리포지토리 등을 참고해주세요.

즐거운 사용 되시길 바랍니다! 
